% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/REMatrix.R
\name{REMatrix}
\alias{REMatrix}
\title{Compute Relative Expression Levels}
\usage{
REMatrix(
  ExpressionSet,
  Phylostratum = NULL,
  by = NULL,
  groups = NULL,
  split = 1e+05,
  showprogress = TRUE,
  threads = 1
)
}
\arguments{
\item{ExpressionSet}{expression object with rownames as GeneID (dgCMatrix)
or standard PhyloExpressionSet object.}

\item{Phylostratum}{a named vector representing phylostratum per GeneID with
names as GeneID (not used if Expression is PhyloExpressionSet).}

\item{by}{specify min/max transformation by row (stages, cells, celltypes)
or by column (phylostratum)}

\item{groups}{specify stages or cells to be grouped into celltypes
by a named list}

\item{split}{specify number of columns to split}

\item{showprogress}{boolean if progressbar should be shown}

\item{threads}{specify number of threads}
}
\value{
a numeric matrix storing the summed partial TEI values for each
strata.
}
\description{
This function computes the relative expression profiles.

In detail, the \emph{Relative Expression Profile} is being computed as
follows over developmental stages s:

\deqn{f_s = (e_s - e_min)/(e_max - e_min)},

as follows over cells:

\deqn{f_c = (e_c - e_min)/(e_max - e_min)},

as follows over celltypes:

\deqn{f_ct = (e_ct - e_min)/(e_max - e_min)},

as follows over phylostrata:

\deqn{f_ps = (e_ps - e_min)/(e_max - e_min)},

where e_min and e_max denote either the minimum/maximum mean expression level
over developmental stages \eqn{s}, cells \eqn{c}, celltypes \eqn{ct} or
phylostrata \eqn{ps}.

This linear transformation corresponds to a shift by \eqn{e_min - e_max}. As
a result, the relative expression level \eqn{f_s} of developmental stage
\eqn{s}, \eqn{f_c} of cell \eqn{c}, \eqn{f_ct} of celltype \eqn{ct} or
\eqn{f_ps} of phylotstratum \eqn{ps} with minimum \eqn{e_s}, \eqn{e_c},
\eqn{e_ct} or \eqn{e_ps} is 0, whereas the relative expression
level \eqn{f_s} of developmental stage \eqn{s}, \eqn{f_c} of cell \eqn{c},
\eqn{f_ct} of celltype \eqn{ct } or \eqn{f_ps} of phylotstratum \eqn{ps}
with maximum \eqn{e_s}, \eqn{e_c}, \eqn{e_ct} or \eqn{e_ps} is 1, and the
relative expression levels of all other stages \eqn{s}, cells \eqn{c},
celltypes \eqn{ct} or phylostrata \eqn{ps} range between 0 and 1.
}
\details{
The partial TEI values combined per strata give an overall
impression of the contribution of each
strata to the global \code{\link{TEI}} pattern.
}
\examples{

## get Seurat object
celegans<-readRDS(file=system.file("extdata",
    "celegans.embryo.SeuratData.rds", package="scTEI")
)

## load Caenorhabditis elegans gene age estimation
celegans_ps<-readr::read_tsv(
   file=system.file("extdata",
   "Sun2021_Orthomap.tsv", package="scTEI")
)

## define Phylostratum
ps_vec<-setNames(
    as.numeric(celegans_ps$Phylostratum),
    celegans_ps$GeneID
)

## get relative expression
Seurat::Idents(celegans)<-"embryo.time.bin"
reM<-REMatrix(
   ExpressionSet=celegans@assays$RNA@counts,
   Phylostratum=ps_vec
)

## get relative expression per cell group
Seurat::Idents(celegans)<-"embryo.time.bin"
cell_groups<-Ident2cellList(Idents(celegans))
reM<-REMatrix(
   ExpressionSet=celegans@assays$RNA@counts,
   Phylostratum=ps_vec,
   groups=cell_groups
)
p1<-ComplexHeatmap::Heatmap(
    reM,
    name="RExp",
    column_title="Relative Expression Profile - cell groups",
    row_title="More Recent <<< More Ancient",
    cluster_rows=FALSE,
    cluster_columns=FALSE,
    col=viridis::viridis(3)
)
p1

## get relative expression over stages per cell group
Seurat::Idents(celegans)<-"embryo.time.bin"
cell_groups<-Ident2cellList(Idents(celegans))
reM<-REMatrix(
   ExpressionSet=celegans@assays$RNA@counts,
   Phylostratum=ps_vec,
   groups=cell_groups,
   by="row"
)
p2<-ComplexHeatmap::Heatmap(
    reM,
    name="RExp",
    column_title="Relative Expression Profile - cell groups - by row",
    row_title="More Recent <<< More Ancient",
    cluster_rows=FALSE,
    cluster_columns=FALSE,
    col=viridis::viridis(3)
)
p2

## get relative expression over phylostrata per cell group
Seurat::Idents(celegans)<-"embryo.time.bin"
cell_groups<-Ident2cellList(Idents(celegans))
reM<-REMatrix(
   ExpressionSet=celegans@assays$RNA@counts,
   Phylostratum=ps_vec,
   groups=cell_groups,
   by="column"
)
p3<-ComplexHeatmap::Heatmap(
    reM,
    name="RExp",
    column_title="Relative Expression Profile - cell groups - by col",
    row_title="More Recent <<< More Ancient",
    cluster_rows=FALSE,
    cluster_columns=FALSE,
    col=viridis::viridis(3)
)
p3
}
\references{
Domazet-Loso T. and Tautz D. (2010).
\emph{A phylogenetically based transcriptome age index mirrors ontogenetic
divergence patterns}. Nature (468): 815-818.

Quint M et al. (2012).
\emph{A transcriptomic hourglass in plant embryogenesis}.
Nature (490): 98-101.

Drost HG et al. (2015)
Mol Biol Evol. 32 (5): 1221-1231 doi:10.1093/molbev/msv012
}
\author{
Kristian K Ullrich
}
